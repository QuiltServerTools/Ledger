name: Release

on:
    release:
        types: [published]

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@v2

            - name: Set up JDK 17
              uses: actions/setup-java@v1
              with:
                  java-version: 17

            - name: Release versions
              env:
                  CURSEFORGE_TOKEN: ${{ secrets.CF_API_TOKEN }}
                  MODRINTH_TOKEN: ${{ secrets.MODRINTH_TOKEN }}
              run: ./gradlew release

            - name: Upload assets to GitHub, Modrinth and CurseForge
              uses: Kir-Antipov/mc-publish@v3.2
              with:
                modrinth-id: LVN9ygNV
                modrinth-featured: false
                modrinth-token: ${{ secrets.MODRINTH_TOKEN }}

                curseforge-id: 491137
                curseforge-token: ${{ secrets.CURSEFORGE_TOKEN }}

                github-token: ${{ secrets.GITHUB_TOKEN }}

                loaders: |
                    fabric
                    quilt